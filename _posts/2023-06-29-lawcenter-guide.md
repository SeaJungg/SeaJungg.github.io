---
layout: post
title: "국가법령정보 공동활용 페이지 정보를 빠짐없이 탈탈 털어먹을 꼼수들"
category: done
---

### 현상 파악
- 판례 데이터와 법령 데이터 DB를 구축하려고 하고 있다.
- 내용을 전체 다운로드받는 건 지원을 안한다. 제목과 고유ID만 있는 목록 다운로드를 통해 각 판례, 각 법령 페이지의 주소를 만든 다음, 그걸 하나하나 들어가서 다운로드 받던지, OPENAPI 계정을 신청해서 조금이나마 편하게 받던지 해야 한다.
- 크롤링을 돌릴 경우 OPENAPI 가입신청 없이도 각 페이지에 접속해서 다운로드하는 코드만 짜면 데이터를 얻을 수 있다. 파싱은 좀 까다롭겠지만..
  - 판례는 https://www.law.go.kr//LSW//precInfoP.do?precSeq={판례ID}로 접속하면 곧바로 다운로드 가능한 페이지가 열린다.
  - 법령은 https://www.law.go.kr//LSW//lsInfoP.do?lsiSeq={법령ID}&chrClsCd=010202&urlMode=lsInfoP&efYd={시행일자8자리}&ancYnChk=0 로 접속하면 곧바로 다운로드 가능한 페이지가 열린다.
- OPENAPI 가입신청을 해두었다면 XML로 한 건씩 받는 것도 가능하다. https://open.law.go.kr/LSO/openApi/guideList.do 에 들어가면 상당히 플레인 텍스트같이 생겼지만 클릭하여 가이드를 확인할 수 있다.
  - 판례는 http://www.law.go.kr/DRF/lawService.do?OC={가입한_이메일_주소중_ID}&target=prec&ID={판례ID}&type=XML 로 곧바로 데이터가 읽힌다.
    - 판례에는 판례뿐만아니라 다른것도 있다.
      - 헌재결정례 http://www.law.go.kr/DRF/lawService.do?OC={가입한_이메일_주소중_ID}&target=detc&ID={dect_id}&type=XML
      - 행정심판례 http://www.law.go.kr/DRF/lawService.do?OC={가입한_이메일_주소중_ID}&target=decc&ID={decc_id}&type=XML
      - 법령해석례 http://www.law.go.kr/DRF/lawService.do?OC={가입한_이메일_주소중_ID}&target=expc&ID={expc_id}&type=XML
  - 법령은 http://www.law.go.kr/DRF/lawService.do?OC={가입한_이메일_주소중_ID}&target=law&ID={법령ID}&type=XML 로 곧바로 데이터가 읽힌다.


### 문제 정의
- https://open.law.go.kr/LSO/lab/lawListSupport.do 에 들어가면 목록 다운로드 서비스를 이용할 수 있다.
- 그런데 목록 다운로드를 4만 건씩밖에 안 준다. html, excel, xml 모두... 다 준 척 하지만? 끝을 보면 순번이 40000에서 끝나있다구?
- 전체 판례는 8만 5660건, 법령은 14만 9712건인데... 나머지는 어쩌라고?    
![판례](..\assets\image\230629-2.png)    
![법령](..\assets\image\230629-3.png)    


### 개선 목표
- 선고일자 기준 range 검색을 지원하니까.. 적당히 잘라보자..
- 국가법령정보센터에 들어가면 선고일자 오름차순 검색을 지원한다.

![에러](..\assets\image\230629-1.png)    
- 최초로 판례가 발생한 날은 1947년 3월 23일이다. https://www.law.go.kr/precSc.do?menuId=7&subMenuId=47&tabMenuId=213&query=
- 최초로 법령이 발생한 날은 1950년 5월 22일이다. 근데 현행법령 기준이라 더 넉넉한 날짜로 봐야 할 것 같다. https://www.law.go.kr/lsSc.do?menuId=1&subMenuId=15&tabMenuId=81&query=
- 판례는 대충 두 번만 자르면 되겠고, 법령은 세 번만 자르면 되겠다.

### 조치 내용
- 적절한 날짜를 구해서 완전한 목록을 얻자.
    - 법령 날짜범위별 법령 개수
        - 1950.01.01~1970.12.31 (15640)
        - 1971.01.01~1980.12.31 (10502)
        - 1981.01.01~1990.12.31 (10060)
        - 여기까지 했는데 숫자가 뭔가 이상해서..세분화를 다시 해본다..
        - 1991.01.01~2000.12.31 (17815)
        - 2001.01.01~2010.12.31 (32827)
        - 2011.01.01~2015.12.31 (22881)
        - 2016.01.01~2023.06.29 (33998)
        - 143723 건인데.... 과거로 더 찾아보니 조선총독부법령 이런 게 있는데 깔끔히 포기하자. 미래로 시각을 돌려서, 시행예정인 550건만 추가해보자.
        - 2023~06.30~2060.06.30 (550)

    - 총 판례 개수는 14만 8382건.
      - 판례 날짜범위별 판례 개수
          - 1940.01.01~1980.12.31 (13191)
          - 1981.01.01~2005.12.31 (39981)
          - 2006.01.01~2023.06.29 (32487)
          - 85659건으로 딱 떨어진다.
      
      - 헌재결정례
        - 29924건. 한번에 됐다. 
      - 법령해석례
        - 7284건. 한번에 됐다. 
      - 행정심판례
        - 25515건. 한번에 됐다. 


- 각 html을 열어서 ID만 뽑아서 하나로 합친 다음 txt로 저장하자.

```cmd

```
- 각 페이지를 연 다음 xml파싱 후 적절한 형태로 mariadb에 밀언허었다.
- 각 페이지별 작업 시간이 천차만별(물론 거의 비슷하겠지만)인 이런 작업엔 병렬처리를 고려하는게 적절하다.. python ThreadPoolExecutor 이용해 실행하자.
```cmd

```